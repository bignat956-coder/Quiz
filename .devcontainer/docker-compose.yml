# .devcontainer/docker-compose.yml

version: '3.8'
services:
  # Your Spring Boot + Angular Application
  app:
    # We use a base image that includes Java 17.
    # We will add Node/Angular using 'features' in the devcontainer.json
    image: mcr.microsoft.com/devcontainers/java:17
    
    # Keep the container running so VS Code can attach
    command: sleep infinity
    
    # This links your app to the 'db' service
    depends_on:
      - db
    
    # Mount your project code into the container
    volumes:
      - ..:/workspace:cached

  # MySQL Database Service
  db:
    image: mysql:8.0
    # This command is often needed for compatibility
    command: --default-authentication-plugin=mysql_native_password
    restart: unless-stopped
    environment:
      # These MUST match your application.properties credentials
      MYSQL_ROOT_PASSWORD: YOUNGMASTER
      MYSQL_DATABASE: quiz_server_db
    ports:
      # This exposes the DB port to your host machine if you want
      # to connect with a local SQL client (like MySQL Workbench)
      - '3306:3306'
    volumes:
      # This line persists your database data even if you stop/restart the container
      - mysql-data:/var/lib/mysql

volumes:
  mysql-data:
